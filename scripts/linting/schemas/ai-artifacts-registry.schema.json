{
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "$id": "https://github.com/microsoft/hve-core/schemas/ai-artifacts-registry.schema.json",
    "title": "AI Artifacts Registry Schema",
    "description": "Schema for the centralized AI artifacts registry containing persona tags, maturity levels, dependency mappings, and metadata for all HVE-Core artifacts",
    "type": "object",
    "required": [
        "$schema",
        "version",
        "personas",
        "agents",
        "prompts",
        "instructions",
        "skills"
    ],
    "properties": {
        "$schema": {
            "type": "string",
            "description": "JSON Schema reference for validation"
        },
        "version": {
            "type": "string",
            "pattern": "^\\d+\\.\\d+$",
            "description": "Registry format version (semver major.minor)"
        },
        "personas": {
            "type": "object",
            "required": [
                "definitions"
            ],
            "properties": {
                "definitions": {
                    "type": "object",
                    "description": "Persona ID to metadata mapping",
                    "additionalProperties": {
                        "type": "object",
                        "required": [
                            "name",
                            "description"
                        ],
                        "properties": {
                            "name": {
                                "type": "string",
                                "minLength": 1
                            },
                            "description": {
                                "type": "string",
                                "minLength": 1
                            }
                        },
                        "additionalProperties": false
                    }
                }
            },
            "additionalProperties": false
        },
        "agents": {
            "type": "object",
            "description": "Agent artifact entries keyed by agent name",
            "additionalProperties": {
                "$ref": "#/$defs/agentEntry"
            }
        },
        "prompts": {
            "type": "object",
            "description": "Prompt artifact entries keyed by prompt name",
            "additionalProperties": {
                "$ref": "#/$defs/simpleArtifactEntry"
            }
        },
        "instructions": {
            "type": "object",
            "description": "Instruction artifact entries keyed by instruction name (use dir/name for subdirectory files)",
            "additionalProperties": {
                "$ref": "#/$defs/simpleArtifactEntry"
            }
        },
        "skills": {
            "type": "object",
            "description": "Skill artifact entries keyed by skill directory name",
            "additionalProperties": {
                "$ref": "#/$defs/simpleArtifactEntry"
            }
        }
    },
    "additionalProperties": false,
    "$defs": {
        "agentEntry": {
            "type": "object",
            "required": [
                "maturity",
                "personas",
                "tags"
            ],
            "properties": {
                "maturity": {
                    "type": "string",
                    "enum": [
                        "stable",
                        "preview",
                        "experimental",
                        "deprecated"
                    ],
                    "description": "Maturity level for channel-based filtering"
                },
                "personas": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9-]*$"
                    },
                    "description": "Persona IDs this artifact belongs to. Empty array means universal (all personas)."
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Freeform categorization tags"
                },
                "requires": {
                    "type": "object",
                    "properties": {
                        "agents": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "description": "Agent names this artifact dispatches at runtime via runSubagent. Handoff targets (frontmatter handoffs field) are resolved dynamically during packaging and excluded from this array to avoid circular dependencies."
                        },
                        "prompts": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "description": "Prompt names this artifact depends on"
                        },
                        "instructions": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "description": "Instruction names this artifact depends on"
                        },
                        "skills": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            },
                            "description": "Skill names this artifact depends on"
                        }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        },
        "simpleArtifactEntry": {
            "type": "object",
            "required": [
                "maturity",
                "personas",
                "tags"
            ],
            "properties": {
                "maturity": {
                    "type": "string",
                    "enum": [
                        "stable",
                        "preview",
                        "experimental",
                        "deprecated"
                    ],
                    "description": "Maturity level for channel-based filtering"
                },
                "personas": {
                    "type": "array",
                    "items": {
                        "type": "string",
                        "pattern": "^[a-z][a-z0-9-]*$"
                    },
                    "description": "Persona IDs this artifact belongs to. Empty array means universal (all personas)."
                },
                "tags": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "description": "Freeform categorization tags"
                }
            },
            "additionalProperties": false
        }
    }
}